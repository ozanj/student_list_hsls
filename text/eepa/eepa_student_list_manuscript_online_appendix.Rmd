---
#title: "A Sociological Analysis of Structural Racism in 'Student List' Lead Generation Products"
#subtitle: ""
#author: 
#  - Ozan Jaquette
#  - Karina G. Salazar
bibliography: ../../assets/bib/eepa_student_list.bib
csl: ../../assets/bib/apa.csl
citeproc: no
output: 
  #bookdown::word_document2:    
  bookdown::pdf_document2:
    toc: FALSE
    number_sections: FALSE
    pandoc_args: !expr rmdfiltr::add_wordcount_filter(rmdfiltr::add_citeproc_filter(args = NULL))
    keep_tex: true
eoutput: pdf_document
always_allow_html: true
urlcolor: blue
fontsize: 12pt
#header-includes:
#      - \usepackage{pdflscape}
#      - \usepackage{geometry}
header-includes:
  - \usepackage{floatrow}
  - \floatsetup{capposition=top}
  #- \usepackage{setspace}\doublespacing
  #- \usepackage{setspace}\onehalfspacing #\doublespacing
  #- \usepackage{setspace}\setstretch{2.0}
  - \usepackage{setspace}
  - \usepackage{fancyhdr}
  - \usepackage{titlesec}
  #- \usepackage[scaled]{helvet}  # https://stackoverflow.com/a/28538633/6373540
  #- \renewcommand{\familydefault}{\sfdefault}
  #- \usepackage[T1]{fontenc}
  - \usepackage{geometry}
  - \usepackage{subfig}
  - \newcommand{\beginsupplement}{
  - \setcounter{table}{0}  
  - \renewcommand{\thetable}{S\arabic{table}} 
  - \setcounter{figure}{0} 
  - \renewcommand{\thefigure}{S\arabic{figure}}}

      
---

```{r setup, include= FALSE}
library(knitr)
library(bookdown)

# https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_pdf.pdf
library(kableExtra)
library(tidyverse)
library(gridExtra)
library(scales)

knitr::opts_chunk$set(echo = F, message = F, warning = F)

knitr::knit_hooks$set(inline = function(x) {   if(!is.numeric(x)){     x   }else{    prettyNum(round(x,2), big.mark=",")    } })

theme_set(
  theme(
    text = element_text(size = 7),
    panel.background = element_blank(),
    plot.title = element_text(color = '#444444', size = 7, hjust = 0.5, face = 'bold'),
    axis.ticks = element_blank(),
    axis.title = element_text(face = 'bold'),
    legend.title = element_text(face = 'bold'),
    legend.key.size = unit(0.3, 'cm')
  )
)


options(knitr.kable.NA = '')
options(scipen = 999)
# webshot::install_phantomjs()

library(ggbreak)
library(usmap)


#load(url('https://github.com/mpatricia01/public_requests_eda/blob/main/data/tbl_fig_data_final.RData?raw=true'))
load(url('https://github.com/mpatricia01/public_requests_eda/blob/main/data/tbl_fig_data_final_v2.RData?raw=true'))

#load in table data
load("./../../outputs/tables/p1_table.Rda")
load("./../../outputs/tables/p2_table.Rda")
load("./../../outputs/tables/p3_table.Rda")
load("./../../outputs/tables/p4_table.Rda")
load("./../../outputs/tables/c1_table.Rda")
load("./../../outputs/tables/c2_table.Rda")
load("./../../outputs/tables/c3_table.Rda")
load("./../../outputs/tables/sample_table.Rda")


theme_set(
  theme(
    text = element_text(size = 7, family = 'Helvetica'),
    panel.background = element_blank(),
    plot.title = element_text(color = '#444444', size = 7, face = 'bold', hjust = 0.5),
    axis.ticks = element_blank(),
    axis.title = element_text(face = 'bold'),
    legend.title = element_text(face = 'bold', hjust = 0),
    legend.key.size = unit(0.3, 'cm'),
    strip.text.x = element_text(size = 7, face = 'bold', hjust = 0.5),
    strip.background = element_rect(fill = NA, color = NA)
  )
)

# color_palette <- c('#bbcfd7', '#d2c8bc', '#ba9a88')
color_palette <- c('#46a69e', '#7ec7b8', '#b9efe6', '#bf7bb2', '#9e508a', '#537ec4', '#344273', '#fdc3bb', '#fa634b')
extra_colors <- c('#b5b5b5', '#767676')
color_text <- 'white'

# https://stackoverflow.com/a/65844319/6373540
linesep <- function(x, y = character()){
  if(!length(x))
    return(y)
  linesep(x[-length(x)], c(rep('', x[length(x)] - 1), '\\addlinespace', y))  
}
```




<!-- 
\pagenumbering{roman}
\newpage
\pagenumbering{gobble}
\pagenumbering{arabic}

\renewcommand*{\thepage}{A\arabic{page}}
--> 





\newpage

# Supplemental Online Appendix


\pagenumbering{gobble}
\pagenumbering{arabic}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{A SOCIOLOGICAL ANALYSIS OF STRUCTURAL RACISM -- ONLINE APPENDIX}
\fancyfoot[R]{\thepage}
\setlength{\headheight}{15pt}

\beginsupplement


```{r em-funnel, echo = FALSE, fig.align = 'center', fig.cap = "The Enrollment Funnel", out.width = "45%"}
knitr::include_graphics('./../../outputs/images/enroll_funnelv2.png')
#knitr::include_graphics('./../../outputs/figures/enrollment_funnel.png')
#![The enrollment funnel](assets/images/enrollment_funnel.png)
```


\begin{landscape}


```{r test-takers, echo = FALSE, fig.align = 'center', fig.cap = "Test Takers Across College Extrance, College Pre-Entrance, and AP Assessments", out.width = "40%", fig.show='hold'}
#knitr::include_graphics('./../../outputs/images/enrollment_funnel.png')
knitr::include_graphics(c("./../../outputs/figures/p1_sat.png","./../../outputs/figures/p1_ap.png"))
knitr::include_graphics(c("./../../outputs/figures/p1_psat.png","./../../outputs/figures/p1_apstem.png"))
knitr::include_graphics(c("./../../outputs/figures/legend_horizontal.png"))


```

\begingroup
\fontsize{8}{8}\selectfont
SOURCE: U.S. Department of Education, National Center for Education Statistics, High School Longitudinal Study of 2009 (HSLS09).
\endgroup

\pagebreak



```{r thresholds-tests-ap, echo = FALSE, fig.align = 'center', fig.cap = "AP Filter Across Thresholds", out.width = "37%", fig.show='hold'}
#knitr::include_graphics('./../../outputs/images/enrollment_funnel.png')
knitr::include_graphics(c("./../../outputs/figures/p2_ap_incv2.png","./../../outputs/figures/p2_ap_excv2.png"))
knitr::include_graphics(c("./../../outputs/figures/p2_apstem_incv2.png","./../../outputs/figures/p2_apstem_excv2.png"))
knitr::include_graphics(c("./../../outputs/figures/legend_horizontal.png"))


```

\begingroup
\fontsize{8}{8}\selectfont
SOURCE: U.S. Department of Education, National Center for Education Statistics, High School Longitudinal Study of 2009 (HSLS09).
\endgroup

\pagebreak

\end{landscape}


\pagebreak


```{r orders-psat, fig.height = 3, fig.cap = "PSAT Filter Used by Research vs. Master's Universities"}
orders_psat_total <- orders_psat %>% 
  filter(test_range == 'psat_min') %>% 
  group_by(univ_type) %>% 
  summarise(
    num_orders = sum(num)
  ) %>% 
  pull(num_orders, univ_type)

orders_psat %>% 
  mutate(
    range_label = recode_factor(
      test_range,
      'psat_min' = 'Minimum',
      'psat_max' = 'Maximum'
    ),
    univ_label = recode_factor(
      univ_type,
      'research' = str_c('Research (N=', orders_psat_total[['research']], ')'),
      'regional' = str_c('M.A. (N=', orders_psat_total[['regional']], ')')
    )
  ) %>% 
  ggplot(aes(x = brks, y = pct, fill = univ_label)) +
  geom_bar(position = position_dodge2(reverse = T, padding = 0), stat = 'identity') +
  geom_text(aes(label = num), hjust = -0.1, size = 2, position = position_dodge2(0.9, reverse = T, padding = 0)) +
  scale_y_continuous(expand = expansion(mult = c(0.01, 0.1)), labels = label_percent(accuracy = 1)) +
  scale_fill_manual(values = color_palette, name = 'University type') +
  xlab('') + ylab('% of orders in university type') +
  facet_wrap(~ range_label) +
  coord_flip()
```


\pagebreak

```{r gpa-ap, echo = FALSE, fig.align = 'center', fig.cap = "Academic Combination: GPA (3.0+) and AP (across score thresholds)", out.width = "80%", fig.show='hold'}
#knitr::include_graphics('./../../outputs/images/enrollment_funnel.png')
knitr::include_graphics(c("./../../outputs/figures/combo3_inc_apv2.png"))
knitr::include_graphics(c("./../../outputs/figures/combo3_inc_apstemv2.png"))
knitr::include_graphics(c("./../../outputs/figures/legend_horizontal.png"))


```

\begingroup
\fontsize{8}{8}\selectfont
SOURCE: U.S. Department of Education, National Center for Education Statistics, High School Longitudinal Study of 2009 (HSLS09).
\endgroup

\pagebreak


```{r descriptives}
df1 <- data.frame(
  category = c("Race/Ethnicity", "White", "Asian", "Hisp", "Black", "Multi", "NH/PI", "AI/AN", "", "Academic Filters",  "College Entrance Exam Completer", "College Pre-Entrance Exam Completer", "AP test-taker (any)", "AP test-taker (STEM)", "Academic GPA", "Missing Academic GPA"),
  unweight = c("", "9,390", "1,370", "2,520", "1,660", "1,410", "70", "110", "", "" , "7,910", "4,780", "2,990", "1,800" ,  "16,480",  "40"),
  n = c("", "2,163,043", "150,222", "920,384", "574,370", "332,043", "18,784", "28,519",  "", "", "1,860,677", "3,086,739", "694,359" , "383,669" , "4,177,402" , "9,964"),
  se = c("", "45,293", "15,373", "41,451", "36,346", "12,921", "5,241", "6,288",  "", "", "54,277", "51,247", "33,918","23,721", "6,863", "6,562"),
  pct = c("", "51.7", "3.6", "22.0", "13.7", "7.9", "0.4", "0.7",  "", "" ,"55.6", "73.7", "16.6",  "9.2", "99.8", "0.2")
)

df1 %>%
  kable(
    booktabs = T, 
    col.names = c(' ', 'Unweighted', 'N', 'SE', 'Pct'), 
    align = c('l', 'r', 'r', 'r', 'r'),
    linesep = '',
    caption = "HSLS09 Descriptive Statistics"
  ) %>%
  row_spec(0, bold = T) %>%
  row_spec(1, bold=T, italic = T) %>%
  row_spec(10,bold=T, italic = T) %>%
  kable_styling(position = 'center', latex_options = c('hold_position', 'scale_down'), font_size = 7) #%>%
   #add_footnote("NOTE: Unweighted sample sizes rounded to nearest 10 per NCES restricted data license regulations", notation=" ")
```
\begingroup\fontsize{8}{12}\selectfont 

_NOTE: Unweighted sample sizes rounded to nearest 10 per NCES restricted data license regulations._

_SOURCE: U.S. Department of Education, National Center for Education
Statistics, High School Longitudinal Study of 2009 (HSLS09)._



\pagebreak
\landscape

```{r sampletable, results='asis'}

# df1 <- data.frame(
#   cat = p1_table$x2race,
#   prop1 = p1_table$testtaker_estimate,
#   prop2 = p1_table$nontesttaker_estimate,
#   diff = round(as.numeric(p1_table$nontesttaker_estimate) - as.numeric(p1_table$nontesttaker_estimate), digits=3 ),
#   pval= p1_table$pval
# )

df %>% 
  kable(
    format = "latex", booktabs = TRUE,
    #longtable = T,
    col.names = c(' ', 'Type', 'Tuition & Fees, In-State', "Total Enrollment", "% Non-Resident", "% Pell", "% Asian", "% Black","% Hispanic", "% Native American", "% Multiracial", "% White"), 
    align = c('l', 'r', 'r', 'r','r', 'r', 'r', 'r', 'r','r', 'r', 'r'),
    linesep = '',
    caption = 'Characteristics of universities in public records request sample',
    ) %>%
  row_spec(0, bold = T, font_size=2) %>%
  #pack_rows("College Entrance Exam", 1, 7) %>%
  #pack_rows("College Pre-Entrance Exam", 8, 14) %>%
  #pack_rows("AP", 15, 21) %>%
  #pack_rows("AP STEM", 22, 28) %>%


  #row_spec(1, bold=T, italic = T, font_size=2) %>%
  #row_spec(9,bold=T, italic = T, font_size=2) %>%
  #row_spec(17,bold=T, italic = T, font_size=2) %>%
  #row_spec(25,bold=T, italic = T, font_size=2) %>%

  kable_styling(position = 'center', latex_options = c('scale_down', "hold_position", "striped",
                    full_width = FALSE), font_size = 3) %>%
  add_header_above(c(" " = 4, "Undergraduate Freshmen" = 7))
```
\begingroup
\fontsize{10}{10}\selectfont
_SOURCE: U.S. Department of Education, Integrated Postsecondary Education Data System, 2017-18._
\endgroup

\pagebreak
\endlandscape




```{r p1table}

# df1 <- data.frame(
#   cat = p1_table$x2race,
#   prop1 = p1_table$testtaker_estimate,
#   prop2 = p1_table$nontesttaker_estimate,
#   diff = round(as.numeric(p1_table$nontesttaker_estimate) - as.numeric(p1_table$nontesttaker_estimate), digits=3 ),
#   pval= p1_table$pval
# )

p1_table %>% 
  kable(
    format = "latex", booktabs = TRUE,
    #longtable = T,
    col.names = c(' ', 'Included', 'Excluded', 'Difference', "Lower CI", "Upper CI"), 
    align = c('l', 'r', 'r', 'r', 'r','r'),
    linesep = '',
    caption = "Assessment Completer Differences in Proportion",
  ) %>%
  row_spec(0, bold = T, font_size=2) %>%
  pack_rows("College Entrance Exam", 1, 7) %>%
  pack_rows("College Pre-Entrance Exam", 8, 14) %>%
  pack_rows("AP", 15, 21) %>%
  pack_rows("AP STEM", 22, 28) %>%


  #row_spec(1, bold=T, italic = T, font_size=2) %>%
  #row_spec(9,bold=T, italic = T, font_size=2) %>%
  #row_spec(17,bold=T, italic = T, font_size=2) %>%
  #row_spec(25,bold=T, italic = T, font_size=2) %>%

  kable_styling(position = 'center', latex_options = c('scale_down', "hold_position", "striped",
                    full_width = FALSE), font_size = 2.5)
```
\begingroup
\fontsize{10}{10}\selectfont
_NOTE: `*`p<0.05, `**`p<0.01, `***`p<0.001_

_SOURCE: U.S. Department of Education, National Center for Education Statistics, High School Longitudinal Study of 2009 (HSLS09)._
\endgroup

\pagebreak


```{r p2table}

# df1 <- data.frame(
#   cat = p1_table$x2race,
#   prop1 = p1_table$testtaker_estimate,
#   prop2 = p1_table$nontesttaker_estimate,
#   diff = round(as.numeric(p1_table$nontesttaker_estimate) - as.numeric(p1_table$nontesttaker_estimate), digits=3 ),
#   pval= p1_table$pval
# )

p2_table %>% 
  kable(
    format = "latex", booktabs = TRUE,
    #longtable = T,
    col.names = c(' ', 'White', 'Asian', 'Hisp', "Black", "Multi", "NH/PI", "AI/AN"), 
    align = c('l', 'r', 'r', 'r', 'r','r', 'r','r'),
    linesep = '',
    caption = "Score Threshold Proportion Differences in Included vs. Excluded across Race/Ethnicity",
  ) %>%
  row_spec(0, bold = T, font_size=6) %>%
  pack_rows("College Entrance Exam", 1, 5) %>%
  pack_rows("College Pre-Entrance Exam", 6, 10) %>%
  pack_rows("AP", 11, 15) %>%
  pack_rows("AP STEM", 16, 20) %>%
  pack_rows("GPA", 21, 25) %>%


  #row_spec(1, bold=T, italic = T, font_size=2) %>%
  #row_spec(9,bold=T, italic = T, font_size=2) %>%
  #row_spec(17,bold=T, italic = T, font_size=2) %>%
  #row_spec(25,bold=T, italic = T, font_size=2) %>%

  kable_styling(position = 'center', latex_options = c('scale_down', "hold_position", "striped",
                    full_width = FALSE), font_size = 4)
```

\begingroup
\fontsize{10}{10}\selectfont
_NOTE: `*`p<0.05, `**`p<0.01, `***`p<0.001_

_SOURCE: U.S. Department of Education, National Center for Education Statistics, High School Longitudinal Study of 2009 (HSLS09)._
\endgroup


```{r p3table}

# df1 <- data.frame(
#   cat = p1_table$x2race,
#   prop1 = p1_table$testtaker_estimate,
#   prop2 = p1_table$nontesttaker_estimate,
#   diff = round(as.numeric(p1_table$nontesttaker_estimate) - as.numeric(p1_table$nontesttaker_estimate), digits=3 ),
#   pval= p1_table$pval
# )

p3_table %>% 
  kable(
    format = "latex", booktabs = TRUE,
    #longtable = T,
    col.names = c(' ', 'White', 'Asian', 'Hisp', "Black", "Multi", "NH/PI", "AI/AN"), 
    align = c('l', 'r', 'r', 'r', 'r','r', 'r','r'),
    linesep = '',
    caption = "Zip Code Affluence Proportion Differences in Included vs. Excluded across Race/Ethnicity",
  ) %>%
  row_spec(0, bold = T, font_size=6) %>%
  pack_rows("Affluence Percentile", 1, 6) %>%


  #row_spec(1, bold=T, italic = T, font_size=2) %>%
  #row_spec(9,bold=T, italic = T, font_size=2) %>%
  #row_spec(17,bold=T, italic = T, font_size=2) %>%
  #row_spec(25,bold=T, italic = T, font_size=2) %>%

  kable_styling(position = 'center', latex_options = c('scale_down', "hold_position", "striped",
                    full_width = FALSE), font_size = 4)
```

\begingroup
\fontsize{10}{10}\selectfont
_NOTE: `*`p<0.05, `**`p<0.01, `***`p<0.001_

_SOURCE: U.S. Department of Education, National Center for Education Statistics, High School Longitudinal Study of 2009 (HSLS09)._
\endgroup

\clearpage

```{r c1table}

# df1 <- data.frame(
#   cat = p1_table$x2race,
#   prop1 = p1_table$testtaker_estimate,
#   prop2 = p1_table$nontesttaker_estimate,
#   diff = round(as.numeric(p1_table$nontesttaker_estimate) - as.numeric(p1_table$nontesttaker_estimate), digits=3 ),
#   pval= p1_table$pval
# )

c1_table %>% 
  kable(
    format = "latex", booktabs = TRUE,
    #longtable = T,
    col.names = c(' ', 'White', 'Asian', 'Hisp', "Black", "Multi", "NH/PI", "AI/AN"), 
    align = c('l', 'r', 'r', 'r', 'r','r', 'r','r'),
    linesep = '',
    caption = "GPA and College Entrance or Pre-Entrance Exam Score Threshold Proportion Differences in Included vs. Excluded across Race/Ethnicity",
  ) %>%
  row_spec(0, bold = T, font_size=6) %>%
  pack_rows("College Entrance Exam", 1, 4) %>%
  pack_rows("College Pre-Entrance Exam", 5, 9) %>%


  #row_spec(1, bold=T, italic = T, font_size=2) %>%
  #row_spec(9,bold=T, italic = T, font_size=2) %>%
  #row_spec(17,bold=T, italic = T, font_size=2) %>%
  #row_spec(25,bold=T, italic = T, font_size=2) %>%

  kable_styling(position = 'center', latex_options = c('scale_down', "hold_position", "striped",
                    full_width = FALSE), font_size = 4)
```

\begingroup
\fontsize{10}{10}\selectfont
_NOTE: `*`p<0.05, `**`p<0.01, `***`p<0.001_

_SOURCE: U.S. Department of Education, National Center for Education Statistics, High School Longitudinal Study of 2009 (HSLS09)._
\endgroup




\clearpage

```{r c3table}

# df1 <- data.frame(
#   cat = p1_table$x2race,
#   prop1 = p1_table$testtaker_estimate,
#   prop2 = p1_table$nontesttaker_estimate,
#   diff = round(as.numeric(p1_table$nontesttaker_estimate) - as.numeric(p1_table$nontesttaker_estimate), digits=3 ),
#   pval= p1_table$pval
# )

c3_table %>% 
  kable(
    format = "latex", booktabs = TRUE,
    #longtable = T,
    col.names = c(' ', 'White', 'Asian', 'Hisp', "Black", "Multi", "NH/PI", "AI/AN"), 
    align = c('l', 'r', 'r', 'r', 'r','r', 'r','r'),
    linesep = '',
    caption = "GPA and AP Proportion Differences in Included vs. Excluded across Race/Ethnicity",
  ) %>%
  row_spec(0, bold = T, font_size=6) %>%
  pack_rows("AP", 1, 5) %>%
  pack_rows("AP STEM", 6, 10) %>%


  #row_spec(1, bold=T, italic = T, font_size=2) %>%
  #row_spec(9,bold=T, italic = T, font_size=2) %>%
  #row_spec(17,bold=T, italic = T, font_size=2) %>%
  #row_spec(25,bold=T, italic = T, font_size=2) %>%

  kable_styling(position = 'center', latex_options = c('scale_down', "hold_position", "striped",
                    full_width = FALSE), font_size = 4)
```
\begingroup
\fontsize{10}{10}\selectfont
_NOTE: `*`p<0.05, `**`p<0.01, `***`p<0.001_

_SOURCE: U.S. Department of Education, National Center for Education Statistics, High School Longitudinal Study of 2009 (HSLS09)._
\endgroup


\clearpage

```{r c2table}

# df1 <- data.frame(
#   cat = p1_table$x2race,
#   prop1 = p1_table$testtaker_estimate,
#   prop2 = p1_table$nontesttaker_estimate,
#   diff = round(as.numeric(p1_table$nontesttaker_estimate) - as.numeric(p1_table$nontesttaker_estimate), digits=3 ),
#   pval= p1_table$pval
# )

c2_table %>% 
  kable(
    format = "latex", booktabs = TRUE,
    #longtable = T,
    col.names = c(' ', 'White', 'Asian', 'Hisp', "Black", "Multi", "NH/PI", "AI/AN"), 
    align = c('l', 'r', 'r', 'r', 'r','r', 'r','r'),
    linesep = '',
    caption = "GPA, College Entrance/Pre-Entrance Exam, by Zip Code Affluence Proportion Differences in Included vs. Excluded across Race/Ethnicity",
  ) %>%
  row_spec(0, bold = T, font_size=6) %>%
  pack_rows("College Entrance Exam (1050+)", 1, 6) %>%
  pack_rows("College Pre-Entrance Exam (150+)", 7, 12) %>%


  #row_spec(1, bold=T, italic = T, font_size=2) %>%
  #row_spec(9,bold=T, italic = T, font_size=2) %>%
  #row_spec(17,bold=T, italic = T, font_size=2) %>%
  #row_spec(25,bold=T, italic = T, font_size=2) %>%

  kable_styling(position = 'center', latex_options = c('scale_down', "hold_position", "striped",
                    full_width = FALSE), font_size = 4)
```
\begingroup
\fontsize{10}{10}\selectfont
_NOTE: `*`p<0.05, `**`p<0.01, `***`p<0.001_

_SOURCE: U.S. Department of Education, National Center for Education Statistics, High School Longitudinal Study of 2009 (HSLS09)._
\endgroup




\clearpage


```{r orders-cluster-en}
en_df <- data.frame(
  cluster = c(51:83, 'Total'),
  sat_math = c(546, 480, 561, 458, 566, 420, 541, 533, 561, 589, 585, 596, 548, 466, 440, 499, 519, 552, 534, 613, 405, 399, 528, 433, 459, 514, 502, 594, 550, 534, 491, 496, 500, 512),
  sat_cr = c(533, 470, 544, 443, 565, 411, 519, 489, 562, 590, 567, 595, 541, 466, 433, 492, 501, 558, 521, 598, 408, 397, 514, 435, 457, 509, 492, 578, 551, 527, 483, 491, 490, 502),
  pct_outofstate = c(0.32, 0.3, 0.32, 0.25, 0.52, 0.29, 0.52, 0.28, 0.52, 0.63, 0.51, 0.67, 0.39, 0.48, 0.23, 0.2, 0.27, 0.52, 0.37, 0.65, 0.39, 0.31, 0.29, 0.29, 0.28, 0.27, 0.26, 0.56, 0.57, 0.39, 0.27, 0.29, 0.19, 0.32),
  pct_nonwhite = c(0.3, 0.58, 0.5, 0.83, 0.24, 0.93, 0.47, 0.87, 0.24, 0.37, 0.3, 0.24, 0.23, 0.34, 0.93, 0.12, 0.53, 0.35, 0.19, 0.29, 0.97, 0.87, 0.42, 0.84, 0.85, 0.38, 0.18, 0.26, 0.32, 0.39, 0.57, 0.21, 0.26, 0.43),
  pct_aid = c(0.57, 0.71, 0.55, 0.76, 0.63, 0.66, 0.43, 0.69, 0.74, 0.36, 0.4, 0.72, 0.65, 0.29, 0.78, 0.76, 0.59, 0.65, 0.65, 0.61, 0.68, 0.47, 0.62, 0.79, 0.72, 0.64, 0.75, 0.39, 0.74, 0.65, 0.72, 0.75, 0.71, 0.65),
  med_income = c(95432, 63578, 92581, 38977, 71576, 35308, 67394, 68213, 54750, 104174, 123858, 59824, 69347, 49829, 45081, 50453, 60960, 57902, 88100, 86381, 42661, 32708, 90849, 44065, 50421, 61332, 62372, 134400, 40909, 49877, 63030, 53465, 49335, 70231)
)

en_df %>% 
  mutate(
    pct_outofstate = percent(pct_outofstate, accuracy = 1),
    pct_nonwhite = percent(pct_nonwhite, accuracy = 1),
    pct_aid = percent(pct_aid, accuracy = 1),
    med_income = dollar(med_income)
  ) %>% 
  kable(
    booktabs = T,
    linesep = linesep(nrow(en_df) - 1, 1),
    col.names = c('2011 D+ Cluster', 'SAT Math', 'SAT CR', 'Going Out of State', 'Percent NonWhite', 'Need Financial Aid', 'Med Income'),
    align = c('l', rep('c', 6)),
    caption = "Filter by neighborhood segments",
  ) %>% 
  row_spec(c(0, nrow(en_df)), bold = T) %>%
  row_spec(c(1, 3, 8, 10, 11, 13, 19, 20, 23, 28), background = color_palette[[3]]) %>% 
  column_spec (1:7, border_left = F, border_right = F) %>% 
  kable_styling(latex_options = 'scale_down')
```
\begingroup
\fontsize{10}{10}\selectfont
_NOTE: All Segment orders analyzed in Figure \@ref(fig:uiuc-deep-dive) filtered for the following school and neighborhood clusters combinations: 1) Neighborhood cluster 51, with any high school cluster; 2) Neighborhood cluster 53, with high school cluster 70; 3) Neighborhood cluster 58, with any high school cluster; 3) Neighborhood cluster 60, with high school clusters 65, 70, or 79; 4) Neighborhood cluster 61, with high school cluster 65; 5) Neighborhood cluster 63, with high school clusters 68 or 70; 6) Neighborhood cluster 69, with high school clusters 65 or 79; 7) Neighborhood cluster 70, with high school clusters 65, 68, 70, or 75; 8) Neighborhood cluster 73, with any high school cluster; 9) Neighborhood cluster 78, with high school cluster 66; 10) High school cluster 79, with any neighborhood._
\endgroup


\clearpage




```{r orders-cluster-hs}
hs_df <- data.frame(
  cluster = c(51:79, 'Total'),
  sat_math = c(462, 489, 471, 376, 489, 536, 434, 592, 499, 523, 485, 474, 440, 606, 515, 498, 526, 541, 390, 595, 400, 528, 451, 654, 514, 600, 595, 473, 594, 514),
  sat_cr = c(457, 496, 484, 371, 481, 508, 435, 577, 489, 549, 370, 473, 427, 542, 503, 515, 546, 540, 395, 581, 412, 544, 438, 579, 502, 584, 508, 468, 585, 502),
  pct_outofstate = c(0.14, 0.81, 0.28, 0.33, 0.39, 0.73, 0.29, 0.51, 0.19, 0.23, 0.33, 0.34, 0.28, 0.37, 0.28, 0.37, 0.48, 0.41, 0.36, 0.56, 0.57, 0.35, 0.24, 0.76, 0.31, 0.72, 0.64, 0.48, 0.61, 0.32),
  pct_nonwhite = c(0.33, 0.99, 0.38, 0.96, 0.46, 0.43, 0.82, 0.27, 0.18, 0.3, 0.89, 0.92, 0.86, 0.89, 0.43, 0.37, 0.41, 0.26, 0.92, 0.33, 0.98, 0.25, 0.89, 0.8, 0.2, 0.5, 0.75, 0.43, 0.26, 0.44),
  pct_aid = c(0.68, 0.77, 0.62, 0.38, 0.44, 0.49, 0.79, 0.32, 0.74, 0.33, 0.09, 0.67, 0.72, 0.57, 0.65, 0.73, 0.69, 0.62, 0.74, 0.48, 0.8, 0.64, 0.76, 0.46, 0.71, 0.28, 0.39, 0.22, 0.71, 0.65),
  med_income = c(40918, 64730, 60833, 38146, 71845, 63967, 48301, 104509, 47685, 70175, 61385, 55515, 49238, 81911, 72692, 60272, 71279, 79260, 43391, 105721, 43137, 70018, 48406, 59089, 72850, 90265, 39490, 56703, 65180, 70223)
)

hs_df %>% 
  mutate(
    pct_outofstate = percent(pct_outofstate, accuracy = 1),
    pct_nonwhite = percent(pct_nonwhite, accuracy = 1),
    pct_aid = percent(pct_aid, accuracy = 1),
    med_income = dollar(med_income)
  ) %>% 
  kable(
    booktabs = T,
    linesep = linesep(nrow(hs_df) - 1, 1),
    col.names = c('2011 D+ Cluster', 'SAT Math', 'SAT CR', 'Going Out of State', 'Percent NonWhite', 'Need Financial Aid', 'Med Income'),
    align = c('l', rep('c', 6)),
    caption="Filter by high school segments"
  ) %>% 
  row_spec(c(0, nrow(hs_df)), bold = T) %>%
  row_spec(c(8, 13:16, 18:20, 23, 25, 29), background = color_palette[[3]]) %>% 
  column_spec (1:7, border_left = F, border_right = F) %>% 
  kable_styling(latex_options = 'scale_down')
```
\begingroup
\fontsize{10}{10}\selectfont
_NOTE: All Segment orders analyzed in Figure \@ref(fig:uiuc-deep-dive) filtered for the following school and neighborhood clusters combinations: 1) Neighborhood cluster 51, with any high school cluster; 2) Neighborhood cluster 53, with high school cluster 70; 3) Neighborhood cluster 58, with any high school cluster; 3) Neighborhood cluster 60, with high school clusters 65, 70, or 79; 4) Neighborhood cluster 61, with high school cluster 65; 5) Neighborhood cluster 63, with high school clusters 68 or 70; 6) Neighborhood cluster 69, with high school clusters 65 or 79; 7) Neighborhood cluster 70, with high school clusters 65, 68, 70, or 75; 8) Neighborhood cluster 73, with any high school cluster; 9) Neighborhood cluster 78, with high school cluster 66; 10) High school cluster 79, with any neighborhood._
\endgroup

\clearpage





